# 第七章 第 3 节 网络攻防

> 原文：[`www.nowcoder.com/tutorial/10091/d7aed786ae544f9192a050864bff4adb`](https://www.nowcoder.com/tutorial/10091/d7aed786ae544f9192a050864bff4adb)

### 3 网络攻防

#### 3.1 请问什么是 SQL 注入攻击？

【频率】★★★★

【难度】☆☆

【参考答案】

SQL 注入，就是通过把 SQL 命令插入到 Web 表单提交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的 SQL 命令。

一般我们提交的表单数据（未经过滤的情况下）都会拼接到 SQL 查询语句中的，就例如：

```cpp
SELECT * FROM users WHERE name='aaa'

```

其中 name 的参数就是从表单中传过来的数据，如果传的参数是一条 SQL 语句，那么就可能骗过了 SQL 数据库，从而执行了一段恶意的代码，达到了攻击效果。

如何防范 SQL 注入？

*   把应用服务器的数据库权限降至最低，尽可能地减少 SQL 注入攻击带来的危害。

*   避免网站打印出 SQL 错误信息，比如类型错误、字段不匹配等，把代码里的 SQL 语句暴露出来，以防止攻击者利用这些错误信息进行 SQL 注入。

*   对进入数据库的特殊字符（'"\尖括号&*;等）进行转义处理，或编码转换。

*   所有的查询语句建议使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入变量嵌入到 SQL 语句中，即不要直接拼接 SQL 语句。

*   在测试阶段，建议使用专门的 SQL 注入检测工具进行检测。网上有很多这方面的开源工具，例如 sqlmap、SQLninja 等。

*   善用数据库操作库，有些库包可能已经做好了相关的防护，只需阅读其文档，看是否支持相应的功能即可。

#### 3.2 请问什么是 XXS 攻击？

【频率】★★★★

【难度】☆☆

【参考答案】

跨站脚本攻击 XSS （Cross Site Scripting），其重点不在于跨站点，而在于脚本的执行。那么 XSS 的原理是：

恶意攻击者在 web 页面中会插入一些恶意的 script 代码。当用户浏览该页面的时候，那么嵌入到 web 页面中 script 代码会执行，因此会达到恶意攻击用户的目的。那么 XSS 攻击最主要有如下分类：反射型、存储型、及 DOM-based 型。 反射性和 DOM-baseed 型可以归类为非持久性 XSS 攻击。存储型可以归类为持久性 XSS 攻击。

反射性 XSS 的原理是：反射性 xss 一般指攻击者通过特定的方式来诱惑受害者去访问一个包含恶意代码的 URL。当受害者点击恶意链接 url 的时候，恶意代码会直接在受害者的主机上的浏览器执行。

**反射型 XSS 的攻击步骤如下：**

1\. 攻击者在 url 后面的参数中加入恶意攻击代码。

2\. 当用户打开带有恶意代码的 URL 的时候，网站服务端将恶意代码从 URL 中取出，拼接在 html 中并且返回给浏览器端。

3\. 用户浏览器接收到响应后执行解析，其中的恶意代码也会被执行到。

4\. 攻击者通过恶意代码来窃取到用户数据并发送到攻击者的网站。攻击者会获取到比如 cookie 等信息，然后使用该信息来冒充合法用户的行为，调用目标网站接口执行攻击等操作。

存储型 XSS 的原理是：主要是将恶意代码上传或存储到服务器中，下次只要受害者浏览包含此恶意代码的页面就会执行恶意代码。

**存储型 XSS 的攻击步骤如下：**

1\. 攻击者将恶意代码提交到目标网站数据库中。

2\. 用户打开目标网站时，网站服务器将恶意代码从数据库中取出，然后拼接到 html 中返回给浏览器中。

3\. 用户浏览器接收到响应后解析执行，那么其中的恶意代码也会被执行。

4\. 那么恶意代码执行后，就能获取到用户数据，比如上面的 cookie 等信息，那么把该 cookie 发送到攻击者网站中，那么攻击者拿到该 cookie 然后会冒充该用户的行为，调用目标网站接口等违法操作。

**如何防范？**

1\. 后端需要对提交的数据进行过滤。

2\. 前端也可以做一下处理方式，比如对 script 标签，将特殊字符替换成 HTML 编码这些等。

DOM 型 XSS 的攻击步骤如下：

1\. 攻击者构造出特殊的 URL、在其中可能包含恶意代码。

2\. 用户打开带有恶意代码的 URL。

3\. 用户浏览器收到响应后解析执行。前端使用 js 取出 url 中的恶意代码并执行。

4\. 执行时，恶意代码窃取用户数据并发送到攻击者的网站中，那么攻击者网站拿到这些数据去冒充用户的行为操作。调用目标网站接口执行攻击者一些操作。

**DOM XSS 是基于文档对象模型的 XSS。一般有如下 DOM 操作：**

1\. 使用 document.write 直接输出数据。

2\. 使用 innerHTML 直接输出数据。

3\. 使用 location、location.href、location.replace、iframe.src、document.referer、window.name 等这些。

#### 3.3 请问什么是 CSRF 攻击？

【频率】★★★★

【难度】☆☆

【参考答案】

CSRF（Cross-site request forgery），中文名称为跨站请求伪造，也被称为：one click attack/session riding，缩写为：CSRF/XSRF

在 CSRF 攻击中攻击者盗用用户的身份，发送恶意请求。CSRF 可能造成的危险：冒名发送邮件，发消息，盗取账号，购买商品，虚拟货币转账等等

**CSRF 的防御：**

CSRF 的防御可以从服务端和客户端两方面着手，防御效果是从服务端着手效果比较好，现在一般的 CSRF 防御也都在服务端进行。

1、服务端进行 CSRF 防御

服务端的 CSRF 方式方法很多样，但总的思想都是一致的，就是在客户端页面增加伪随机数。

*   Cookie Hashing

所有表单都包含同一个伪随机值，因为攻击者不能获得第三方的 Cookie(理论上)，所以表单中的数据也就构造失败了。

*   验证码

每次的用户提交都需要用户在表单中填写一个图片上的随机字符串，这个方案可以完全解决 CSRF

*   One-Time Tokens(不同的表单包含一个不同的伪随机值)

在实现 One-Time Tokens 时，需要注意一点：并行会话的兼容。如果用户在一个站点上同时打开了两个不同的表单，CSRF 保护措施不应该影响到他对任何表单的提交。考虑一下如果每次表单被装入时站点生成一个伪随机值来覆盖以前的伪随机值将会发生什么情况：用户只能成功地提交他最后打开的表单，因为所有其他的表单都含有非法的伪随机值。必须小心操作以确保 CSRF 保护措施不会影响选项卡式的浏览或者利用多个浏览器窗口浏览一个站点。

### 3.4 总结

本章主要介绍了计算机网络相关的一些考点，提供了一些参考答案帮助大家学习，本章考点大都以记忆为主，因篇幅有限，本章所列的考点仅个人秋招时遇到的考点，答案也是个人所学与参考书所得，若有欠缺与错误的地方，欢迎大家及时在评论区留言指出。