# 第六章 第 8 节 Java-操作系统-8

> 原文：[`www.nowcoder.com/tutorial/10070/80dda3b2f8704029b2fb8c3f3ec147a1`](https://www.nowcoder.com/tutorial/10070/80dda3b2f8704029b2fb8c3f3ec147a1)

#### 1.37 说一下 epoll 的原理，它的查询速度是 O(1)的吗？

**参考回答**

epoll 是一种更加高效的 IO 多路复用的方式，不同于忙轮询和无差别轮询，epoll 会把哪个流发生了怎样的 I/O 事件通知我们。时间复杂度为 O(1)。

epoll 的执行过程如图所示：

![](img/2aaea7625443bc6e250ab739f3a51b4c.png)

1.  创建红黑树，调用 epoll_create()创建一颗空的红黑树，用于存放 FD 及其感兴趣事件；

2.  注册感兴趣事件，调用 epoll_ctl()向红黑树中添加节点（FD 及其感兴趣事件），时间复杂度 O(logN)，向内核的中断处理程序注册一个回调函数，告诉内核，如果这个句柄的中断到了，就把它添加到就绪队列中。所以，当一个 socket 上有数据到了，内核在把网卡上的数据 copy 到内核中后就来把 socket 插入到就绪队列中了；

3.  获取就绪事件，调用 epoll_wait()返回就绪队列中的就绪事件，时间复杂度 O(1)；

#### 1.38 介绍域名解析成 IP 的全过程。

**参考回答**

**第一步：检查浏览器缓存中是否缓存过该域名对应的 IP 地址**

用户通过浏览器浏览过某网站之后，浏览器就会自动缓存该网站域名对应的地址，当用户再次访问的时候，浏览器就会从缓存中查找该域名对应的 IP 地址，因为缓存不仅是有大小限制，而且还有时间限制（域名被缓存的时间通过属性来设置），所以存在域名对应的找不到的情况。当浏览器从缓存中找到了该网站域名对应的地址，那么整个解析过程结束，如果没有找到，将进行下一步骤。对于的缓存时间问题，不宜设置太长的缓存时间，时间太长，如果域名对应的发生变化，那么用户将在一段时间内无法正常访问到网站，如果太短，那么又造成频繁解析域名。

**第二步：如果在浏览器缓存中没有找到 IP，那么将继续查找本机系统是否缓存过 IP**

如果第一个步骤没有完成对域名的解析过程，那么浏览器会去系统缓存中查找系统是否缓存过这个域名对应的地址，也可以理解为系统自己也具备域名解析的基本能力。在系统中，可以通过设置文件来将域名手动绑定到某上，文件位置在。对于普通用户，并不推荐自己手动绑定域名和，对于开发者来说，通过绑定域名和，可以轻松切换环境，可以从测试环境切换到开发环境，方便开发和测试。在系统中，黑客常常修改他的电脑的文件，将用户常常访问的域名绑定到他指定的上，从而实现了本地解析，导致这些域名被劫持。在或者系统中，文件在，修改该文件也可以实现同样的目的。

前两步都是在本机上完成的，所以没有在上面示例图上展示出来，从第三步开始，才正在地向远程 DNS 服务器发起解析域名的请求。

**第三步：向本地域名解析服务系统发起域名解析的请求**

如果在本机上无法完成域名的解析，那么系统只能请求本地域名解析服务系统进行解析，本地域名系统一般都是本地区的域名服务器，比如你连接的校园网，那么域名解析系统就在你的校园机房里，如果你连接的是电信、移动或者联通的网络，那么本地域名解析服务器就在本地区，由各自的运营商来提供服务。对于本地服务器地址，系统使用命令就可以查看，在和系统下，直接使用命令来查看服务地址。一般都缓存了大部分的域名解析的结果，当然缓存时间也受域名失效时间控制，大部分的解析工作到这里就差不多已经结束了，负责了大部分的解析工作。

**第四步：向根域名解析服务器发起域名解析请求**

本地域名解析器还没有完成解析的话，那么本地域名解析服务器将向根域名服务器发起解析请求。

**第五步：根域名服务器返回 gTLD 域名解析服务器地址**

本地域名解析向根域名服务器发起解析请求，根域名服务器返回的是所查域的通用顶级域（）地址，常见的通用顶级域有、、、等。

**第六步：向 gTLD 服务器发起解析请求**

本地域名解析服务器向 gTLD 服务器发起请求。

**第七步：gTLD 服务器接收请求并返回 Name Server 服务器**

服务器接收本地域名服务器发起的请求，并根据需要解析的域名，找到该域名对应的域名服务器，通常情况下，这个服务器就是你注册的域名服务器，那么你注册的域名的服务商的服务器将承担起域名解析的任务。

**第八步：Name Server 服务器返回 IP 地址给本地服务器**

服务器查找域名对应的地址，将地址连同值返回给本地域名服务器。

**第九步：本地域名服务器缓存解析结果**

本地域名服务器缓存解析后的结果，缓存时间由时间来控制。

#### 1.39 如何在 Linux 上配置一个 IP 地址，如果给定端口号如何解析出域名？

**参考回答**

1.  配置 Linux 系统的 IP 地址的方法，主要有以下三种：

*   ifconfig

    ifconfig 命令主要是用来查看网卡的配置信息，因为用它来配置网卡的 IP 地址时，只会临时生效（Linux 服务器重启后就会失效）

*   setup

    setup 命令是 redhat 系列的 linux 系统（如 CentOS）中专有的命令工具。可以使用 setup 命令，来对网络配置中的 IP 地址、子网掩码、默认网关、DNS 服务器进行设置。而且，setup 网络配置工具设置的 IP 地址会永久生效。

*   修改网卡的配置文件

    直接修改网卡的配置文件，设置方法有两种：

    *   自动获取动态 IP 地址
    *   手工配置静态的 IP 地址

2.  使用 dig 命令解析域名

#### 1.40 解释一下 IP 地址、子网掩码、网关。

**参考回答**

1.  IP 地址

　　IP 地址有一个 32 位的连接地址,由 4 个 8 位字段组成,8 位字段称为 8 位位组,每个 8 位位组之间用点号隔开，用于标识 TCP/IP 宿主机。每个 IP 地址都包含两部分:网络 ID 和主机 ID,网络 ID 标识在同一个物理网络上的所有宿主机,主机 ID 标识网络上的每一个宿主机,运行 TCP/IP 的每个计算机都需要唯一的 IP 地址。

　　Intenet 委员会定义了五种地址类型以适应不同尺寸的网络。地址类型定义网络 ID 使用哪些位,它也定义了网络的可能数目和每个网络可能的宿主机数目．

2.  子网掩码(Subnet Mask)

　　使用子网可以把单个大网分成多个物理网络,并用路由器把它们连接起来。子网掩码用于屏蔽 IP 地址的一部分,使得 TCP/IP 能够区别网络 ID 和宿主机 ID。当 TCP/IP 宿主机要通信时,子网掩码用于判断一个宿主机是在本地网络还是在远程网络。

　　缺省的子网掩码用于不分成子网的 TCP/IP 网络,对应于网络 ID 的所有位都置为 1,每个 8 位位组的十进制数是 255,对应于宿主机 ID 的所有位都置为 0。

　　用于子网掩码的位数决定可能的子网数目和每个子网的宿主机数目,子网掩码的位数越多,则子网越多,但是宿主机也较少。

　　例:假设 A 类地址子网数是 14,则所需位数至少为 4,用于子网的位为: 　　11111111, 11110000, 00000000, 00000000, 子网掩码为 255.240.0.0,每个子网的宿主机数目为 2²⁰-2=1,048, 574 个。

3.  网关（Gateway）

　　网关就是一个网络连接到另一个网络的“关口”。 按照不同的分类标准，网关也有很多种。TCP/IP 协议里的网关是最常用的，在这里我们所讲的“网关”均指 TCP/ IP 协议下的网关。

　　网关实质上是一个网络通向其他网络的 IP 地址。比如有网络 A 和网络 B，网络 A 的 IP 地址范围为“192.168.1.1~192\. 168.1.254”，子网掩码为 255.255.255.0；网络 B 的 IP 地址范围为“192.168.2.1~192\. 168.2.254”，子网掩码为 255.255.255.0。在没有路由器的情况下，两个网络之间是不能进行 TCP/IP 通信的，即使是两个网络连接在同一台交换机（或集线器）上，TCP/IP 协议也会根据子网掩码（255.255.255.0）判定两个网络中的主机处在不同的网络里。而要实现这两个网络之间的通信，则必须通过网关。

　　如果网络 A 中的主机发现数据包的目的主机不在本地网络中，就把数据包转发给它自己的网关，再由网关转发给网络 B 的网关，网络 B 的网关再转发给网络 B 的某个主机。网络 B 向网络 A 转发数据包的过程也是如此。而要实现这两个网络之间的通信，则必须通过网关。如果网络 A 中的主机发现数据包的目的主机不在本地网络中，就把数据包转发给它自己的网关，再由网关转发给网络 B 的网关，网络 B 的网关再转发给网络 B 的某个主机。网络 B 向网络 A 转发数据包的过程也是如此 所以说，只有设置好网关的 IP 地址，TCP/IP 协议才能实现不同网络之间的相互通信。那么这个 IP 地址是哪台机器的 IP 地址呢？网关的 IP 地址是具有路由功能的设备的 IP 地址，具有路由功能的设备有路由器、启用了路由协议的服务器（实质上相当于一台路由器）、代理服务器（也相当于一台路由器）。

#### 1.41 说说 IP 如何寻址？

**参考回答**

IP 寻址包括本地网络寻址和非本地网络寻址两部分

1.  本地网络寻址

    假设有 2 个主机，他们是属于同一个网段。主机 A 和主机 B，首先主机 A 通过本机的 hosts 表或者 wins 系统或 dns 系统先将主机 B 的计算机名转换为 IP 地址，然后用自己的 IP 地址与子网掩码计算出自己所出的网段，比较目的主机 B 的 ip 地址与自己的子网掩码，发现与自己是出于相同的网段，于是在自己的 ARP 缓存中查找是否有主机 B 的 mac 地址，如果能找到就直接做数据链路层封装并且通过网卡将封装好的以太网帧发送有物理线路上去。

    如果 arp 缓存中没有主机 B 的的 mac 地址，主机 A 将启动 arp 协议通过在本地网络上的 arp 广播来查询主机 B 的 mac 地址，获得主机 B 的 mac 地址厚写入 arp 缓存表，进行数据链路层的封装，发送数据。

2.  非本地网络寻址

    假设 2 个主机不是相同的网段，不同的数据链路层网络必须分配不同网段的 IP 地址并且由路由器将其连接起来。主机 A 通过本机的 hosts 表或 wins 系统或 dns 系统先主机 B 的计算机名转换为 IP 地址，然后用自己的 IP 地址与子网掩码计算出自己所处的网段，比较目的目的主机 B 的 IP 地址，发现与自己处于不同的网段。于是主机 A 将知道应该将次数据包发送给自己的缺省网关，即路由器的本地接口。

    主机 A 在自己的 ARP 缓存中查找是否有缺省网关的 MAC 地址，如果能够找到就直接做数据链路层封装并通过网卡，将封装好的以太网数据帧发送到物理线路上去，如果 arp 缓存表中没有缺省网关的 Mac 地址，主机 A 将启动 arp 协议通过在本地网络上的 arp 广播来查询缺省网关的 mac 地址，获得缺省网关的 mac 地址后写入 arp 缓存表，进行数据链路层的封装，发送数据。

    数据帧到达路由器的接受接口后首先解封装，变成 IP 数据包，对 IP 包进行处理，根据目的 IP 地址查找路由表，决定转发接口后做适应转发接口数据链路层协议帧的封装，并且发送到下一跳路由器，此过程继续直至到达目的的网络与目的主机。